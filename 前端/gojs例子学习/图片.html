<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SVG Tiger Drawing in GoJS</title>
    <meta name="description" content="Importing some SVG as GoJS Shapes."/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="./js/go.js"></script>
    <script src="./js/goTool.js"></script>
    <script>

        function init() {


            if (window.goSamples) goSamples();  // init for these samples -- you don't need to call this
            var goTool = new GoTool("myDiagramDiv", {
                //允许左侧调色板中的节点拖入右侧图表绘制区
                initialPosition: new go.Point(0, 0),
                allowDrop: true,
                allowZoom: true,
                allowVerticalScroll: false,
                //禁止动画效果
                "animationManager.isEnabled": false,
                "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
                initialContentAlignment: go.Spot.Center,
                "grid.visible": true,
                "undoManager.isEnabled": true,
            });

            goTool.diagram.add(
                goTool.make(go.Part,  // this Part is not bound to any model data
                    {
                        layerName: "Background", position: new go.Point(0, 0),
                        selectable: false, pickable: false
                    },
                    goTool.make(go.Picture, "./images/apple.png")
                )
            );

            //创建模板2
            goTool.diagram.nodeTemplate = goTool.make(
                go.Part,
                goTool.make(go.Shape, "TransmittalTape",
                    {strokeWidth: 0, stroke: "#C2185B", fill: "palegreen"},
                ),
                new go.Binding("location", "loc"),
                new go.Binding("width"),
                new go.Binding("height"),
                goTool.make(go.TextBlock, new go.Binding("text", "name")),
            )

            goTool.diagram.contextMenu = goTool.make(
                "ContextMenu",
                goTool.make("ContextMenuButton",
                    goTool.make(go.TextBlock, "标记地点"),
                    {
                        click: function (e, obj) {
                            goTool.diagram.model.startTransaction("addPoint");
                            var name = document.getElementById("testImageName")
                            let nodeData = {
                                name: name.value,
                                width: name.value.length + 100,
                                height: 20,
                                loc: new go.Point(e.dz.x, e.dz.y - 20)
                            }
                            goTool.diagram.model.addNodeData(nodeData);
                            goTool.diagram.model.commitTransaction("addPoint");
                        }
                    }
                ),
            )

            goTool.diagram.model.nodeDataArray = [
                {name: "测试图片", width: 80, height: 20, loc: new go.Point(11, 1)}
            ]
        }

    </script>
</head>
<body onload="init()">
<div id="sample">
    <input type="text" id="testImageName">
    <input type="button" id="save">
    <div id="myDiagramDiv" style="border: solid 1px black; width:99%; height:500px"></div>
</div>
</body>
</html>
